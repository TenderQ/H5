var H5=function(){return this.id=("h5_"+Math.random()).replace(".","_"),this.el=$('<div class="h5" id='+this.id+">").hide(),this.page=[],$("body").append(this.el),this.addPage=function(t,e){var a=$('<div class="h5_page section">');return void 0!==t&&a.addClass("h5_page_"+t),void 0!==e&&a.text(e),this.el.append(a),this.page.push(a),"function"==typeof this.whenAddPage&&this.whenAddPage(),this},this.addComponent=function(t,e){var e=e||{};e=$.extend({type:"base"},e);var a,n=this.page.slice(-1)[0];switch(e.type){case"base":a=new H5ComponentBase(t,e);break;case"polyline":a=new H5ComponentPolyline(t,e);break;case"pie":a=new H5ComponentPie(t,e);break;case"bar":a=new H5ComponentBar(t,e);break;case"radar":a=new H5ComponentRadar(t,e);break;case"point":a=new H5ComponentPoint(t,e);break;case"ring":a=new H5ComponentRing(t,e)}return n.append(a),this},this.loader=function(t){this.el.fullpage({onLeave:function(t,e,a){$(this).find(".h5_component").trigger("onLeave")},afterLoad:function(t,e){$(this).find(".h5_component").trigger("onLoad")}}),this.page[0].find(".h5_component").trigger("onLoad"),this.el.show(),t&&$.fn.fullpage.moveTo(t)},this.loader="function"==typeof H5_loading?H5_loading:this.loader,this},H5ComponentBar=function(t,e){e=$.extend({direction:"horizontal"},e),"vertical"===e.direction&&(e.type+="_v");var a=new H5ComponentBase(t,e);return $.each(e.data,function(t,n){var i=$('<div class="line">'),o=$('<div class="name">'),s=$('<div class="rate">'),r=$('<div class="per">'),d=100*n[1]+"%",c="";c=n[2]?'style="background-color:'+n[2]+'"':'style="background-color:'+e.data[0][2]+'"',s.html('<div class="bg" '+c+"></div>"),"vertical"===e.direction?s.height(d):s.width(d),o.text(n[0]),r.text(d),i.append(o).append(s),s.append(r),a.append(i)}),a},H5ComponentBase=function(t,e){var e=e||{},a=("h5_c_"+Math.random()).replace(".","_"),n="h5_component_"+e.type+" h5_component_name_"+t,i=$('<div class="h5_component '+n+'" id='+a+">");e.text&&i.text(e.text),e.width&&i.width(e.width),e.height&&i.height(e.height),e.css&&i.css(e.css),e.bg&&i.css("backgroundImage","url("+e.bg+")"),!0===e.alignCenter&&i.css({marginLeft:e.width/2*-1,left:"50%"}),!0===e.center&&i.css({marginLeft:e.width/2*-1,marginTop:e.height/2*-1,left:"50%",top:"50%"}),"function"==typeof e.onclick&&i.on("click",e.onclick);var o="h5_component_"+e.type+"_leave",s="h5_component_"+e.type+"_load";return i.on("onLeave",function(){return setTimeout(function(){i.addClass(o).removeClass(s),e.animateOut&&i.animate(e.animateOut),e.animateOutClass&&i.removeClass(e.animateInClass).addClass("animated "+e.animateOutClass)},e.delay||0),!1}),i.on("onLoad",function(){return setTimeout(function(){i.addClass(s).removeClass(o),e.animateIn&&i.animate(e.animateIn),e.animateInClass&&i.removeClass(e.animateOutClass).addClass("animated "+e.animateInClass)},e.delay||0),!1}),i},H5ComponentPie=function(t,e){var a=new H5ComponentBase(t,e),n=e.width,i=e.height,o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,$(o).css({zIndex:"1"}),a.append(o);var r=n/2,d=e.data.length;s.beginPath(),s.fillStyle="#eee",s.strokeStyle="#eee",s.lineWidth=1,s.arc(r,r,r,0,2*Math.PI),s.fill(),s.stroke();var o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,$(o).css({zIndex:"2"}),a.append(o);for(var c=["#90ed7d","#f7a35c","#8085e9","#f15c80","#7cb5ec","#334b5c"],h=1.5*Math.PI,l=0,p=2*Math.PI,f=0;f<d;f++){var v=e.data[f],g=v[2]||(v[2]=c.shift());l=h+p*v[1],s.beginPath(),s.fillStyle=g,s.strokeStyle=g,s.lineWidth=.1,s.moveTo(r,r),s.arc(r,r,r,h,l),s.fill(),s.stroke(),h=l;var m=$('<div class="text">');m.text(v[0]);var u=$('<div class="per">');u.text(100*v[1]+"%");var w=r+Math.sin(.5*Math.PI-h)*r,C=r+Math.cos(.5*Math.PI-h)*r;w>n/2?m.css("left",w):m.css("right",n-w),C>i/2?m.css("top",C):m.css("bottom",i-C),v[2]&&m.css("color",g),m.css("opacity",0),m.append(u),a.append(m)}var o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,$(o).css({zIndex:"3"}),a.append(o),s.fillStyle="#eee",s.strokeStyle="#eee",s.lineWidth=1;var y=function(t){s.clearRect(0,0,n,i),s.beginPath(),s.moveTo(r,r),t>=1&&a.find(".text").css("opacity",1),t<=0?(s.arc(r,r,r,0,2*Math.PI),a.find(".text").css("opacity",0)):s.arc(r,r,r,h,h+2*Math.PI*t,!0),s.fill(),s.stroke()};return y(0),a.on("onLoad",function(){for(var t=0,e=0;e<100;e++)setTimeout(function(){t+=.01,y(t)},10*e+500)}),a.on("onLeave",function(){for(var t=1,e=0;e<100;e++)setTimeout(function(){t-=.01,y(t)},10*e+500)}),a},H5ComponentPoint=function(t,e){var a=new H5ComponentBase(t,e),n=e.data[0][1];return $.each(e.data,function(t,e){var i=$('<div class="point point_'+t+'">'),o=$('<div class="name">'+e[0]+"</div>"),s=$('<div class="per">'+100*e[1]+"%</div>");o.append(s),i.append(o);var r=e[1]/n*100+"%";i.width(r).height(r),e[2]&&i.css("backgroundColor",e[2]),void 0!=e[3]&&void 0!=e[4]&&i.css("left",e[3]).css("top",e[4]),a.append(i)}),a},H5ComponentPolyline=function(t,e){var a=new H5ComponentBase(t,e),n=e.width,i=e.height,o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,a.append(o);var r=10;s.beginPath(),s.lineWidth=1,s.strokeStyle="#aaa";for(var d=0;d<r+1;d++){var c=i/r*d;s.moveTo(0,c),s.lineTo(n,c)}r=e.data.length+1;for(var h=n/r>>0,d=0;d<r+1;d++){var l=n/r*d;if(s.moveTo(l,0),s.lineTo(l,i),e.data[d]){var p=$('<div class="text">');p.text(e.data[d][0]),p.css("width",h).css("left",l+h/2),a.append(p)}}s.stroke();var o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,a.append(o);var f=function(t){s.clearRect(0,0,n,i),s.beginPath(),s.lineWidth=2,s.strokeStyle="#ff8878";var a=0,o=0;r=e.data.length+1;var d=n/r;for(var c in e.data)if(e.data.hasOwnProperty(c)){var h=e.data[c];a=d*c+d,o=i-h[1]*i*t,s.moveTo(a,o),s.arc(a,o,3,0,2*Math.PI),s.fillStyle="rgb(255,118,118)",s.fill()}s.moveTo(d,i-e.data[0][1]*i*t);for(var c in e.data){var h=e.data[c];a=d*c+d,o=i-h[1]*i*t,s.lineTo(a,o)}s.stroke(),s.lineWidth=1,s.strokeStyle="rgba(255,118,118,0)",s.lineTo(a,i),s.lineTo(d,i),s.fillStyle="rgba(255,118,118,0.4)",s.fill();for(var c in e.data){var h=e.data[c];a=d*c+d,o=i-h[1]*i*t,s.moveTo(a,o),s.fillStyle=h[2]?h[2]:"#595959",s.fillText((100*h[1]>>0)+"%",a-10,o-10)}s.stroke()};return a.on("onLoad",function(){for(var t=0,e=0;e<100;e++)setTimeout(function(){t+=.01,f(t)},10*e+500)}),a.on("onLeave",function(){for(var t=1,e=0;e<100;e++)setTimeout(function(){t-=.01,f(t)},10*e)}),a},H5ComponentRadar=function(t,e){var a=new H5ComponentBase(t,e),n=e.width,i=e.height,o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,a.append(o);for(var r=n/2,d=e.data.length,c=!1,h=10;h>0;h--){s.beginPath();for(var l=0;l<d;l++){var p=2*Math.PI/360*(360/d)*l,f=r+Math.sin(p)*r*(h/10),v=r+Math.cos(p)*r*(h/10);s.lineTo(f,v)}s.closePath(),s.fillStyle=(c=!c)?"#99c0ff":"#f1f9ff",s.fill()}for(var l=0;l<d;l++){var p=2*Math.PI/360*(360/d)*l,f=r+Math.sin(p)*r,v=r+Math.cos(p)*r;s.moveTo(r,r),s.lineTo(f,v);var g=$('<div class="text">');g.text(e.data[l][0]),g.css("transition","all .5s "+.1*l+"s"),f>n/2?g.css("left",f+5):g.css("right",n-f+5),v>i/2?g.css("top",v+5):g.css("bottom",i-v+5),e.data[l][2]&&g.css("color",e.data[l][2]),g.css("opacity",0),a.append(g)}s.strokeStyle="#e0e0e0",s.stroke();var o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,a.append(o),s.strokeStyle="#f00";var m=function(t){t>=1&&a.find(".text").css("opacity",1),t<=0&&a.find(".text").css("opacity",0),s.clearRect(0,0,n,i),s.beginPath();for(var o=0;o<d;o++){var c=2*Math.PI/360*(360/d)*o,h=e.data[o][1]*t,l=r+Math.sin(c)*r*h,p=r+Math.cos(c)*r*h;s.lineTo(l,p)}s.closePath(),s.fillStyle="rgba(255, 118, 118, 0.6)",s.fill(),s.stroke(),s.fillStyle="rgb(255, 118, 118";for(var o=0;o<d;o++){var c=2*Math.PI/360*(360/d)*o,h=e.data[o][1]*t,l=r+Math.sin(c)*r*h,p=r+Math.cos(c)*r*h;s.beginPath(),s.arc(l,p,4,0,2*Math.PI),s.fill(),s.closePath()}};return a.on("onLoad",function(){for(var t=0,e=0;e<100;e++)setTimeout(function(){t+=.01,m(t)},10*e+500)}),a.on("onLeave",function(){for(var t=1,e=0;e<100;e++)setTimeout(function(){t-=.01,m(t)},10*e+500)}),a},H5ComponentRing=function(t,e){e.type="pie",e.data.length>1&&(e.data=[e.data[0]]);var a=new H5ComponentPie(t,e),n=$('<div class="mask">');a.addClass("h5_component_ring"),a.append(n);var i=a.find(".text");return i.attr("style",""),e.data[0][2]&&i.css("color",e.data[0][2]),n.append(i),a},H5_loading=function(t,e){var a=this.id;if(void 0===this._images){this._images=(t||[]).length,this._loaded=0,window[a]=this;for(s in t){var n=t[s],i=new Image;i.onload=function(){window[a].loader()},i.src=n}return $("#rate").text("0%"),this}this._loaded++;var o=this._loaded/this._images*100>>0;if($("#loading-rate").text(o+"%"),this._loaded<this._images)return this;window[a]=null,this.el.fullpage({onLeave:function(t,e,a){$(this).find(".h5_component").trigger("onLeave")},afterLoad:function(t,e){$(this).find(".h5_component").trigger("onLoad")}}),this.page[0].find(".h5_component").trigger("onLoad"),this.el.show()};